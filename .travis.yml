env:
  global:
  - GCP_PROJECT_ID=eksamen-devops
  - tf_version=0.13.3
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - secure: Nh9i1jFUQiAlYH4DTq1XQPTPh9wh+2LTkWtPvuf6beGmP7s2mPbLR/xWyGWW+ktTIvBzzhp8FpBW70dq8+Oy3u/d5VPvKQ8U5ZoUxdWbho3hysRvfwThBHz7bgb3wK6jZ69VMBVOoULLvulUWnlRR9vV9ZDOJJwFciMpcQoPSyXcWjqK4M7DUxlVYdmz1vCgClU7AuA/idWT3CRS6RqKTxOhpG7L8hWOgzpLSVWJOfxzGiVARTRUaf8cQeFJRjAuWg0K/krOWzMusU/N9ln52HT88lB8inThA7TkLx3MqFdctlKtJTIm/ZzbcOeH9Dw9qSlUKl/jfD4GGxiv7lOKVz1pcke2Y/SjBU+MdCFmMyxG7+C6UBLYAug0tjKuKmpK+4d3KOvQuOHzzUdY+68cC8UOh67cGoQzYIsEqtWrU7sQHhcSrrfX50pNqMW6X1C01JIud8txKkRIkVrWd079E5LnJx3srKFSIOvfdwe+TyMuTrngDDW6YdloqUgQAa4JeCRwW4ZcUc4Q0iDepyYmlh9dyukl/EoKPg2d8eeeyqPzU6NmdihmIivoQxxi3LT7aMJy3h5x01U2q+LVuJe38SeCaIeOMA8mUQXQtZ8UaT4JrA99P+d6YWwqJ3i9gc4nHW4piEEsySA1eaoqs9cLQIolJ0+lhbdL36lDMbOEJL0=
  - secure: IikHqhVlgr8EJlGdub7acvVy+B3Mo7LYa4+G806KDbBueS4Cb3ThCq/DxJEBJnHqIoPnCaZoiEMtaD2UllvVk3AgZv8lGlOiQWDhNhaZ1aCNNQru7yKmihXjUeCr5zPM9YQRn8Kgfup0b9p9hug7R16ZeAGHSpvJz4/8JIeoi7DDMabn/0Fs7UtByMg79pvgoKxN/NhDjii0iZ2FmSz8L5CfzveAui4hdCNYSYKxVsPnxuY6mFr7oDlx2TOFY4uV2TDp+RTlMC5WMkhasDzFjeH4DpbmS0IJcyO0oAI7os57NurGj03HdMqtQD7sGbS+qFnsnbY2d46ywVaXs/oDUcfa3rMKQWs8Jf06Wqb4lCulgcdkEqlrUO9JoRqgLPY9DC0Bjyth01W9isOXMBwUiCnRXRP8EtgdvktFzJ9yHmSYhbLHGkRsnqNbhBO50Q3N4Ffm9jtgZeEsxXnEwELfLUJshFYv6NNhAQWDVl3x9ruHYXEypFvZHKQeE2aTIsHue4fK5jWgLhfZsQ6uu/ckvVyoBacmnSNa07vtfiLp+HTYZriTm/Z6q3K25n/QxOToMXqAfNAFN3SmEfcZ502TGtdb8OVkeP1EE5lbpO7pAAs3/io1L5FFKoavtM+G+vDJwJ+GEQD48xntshb2ALPAX7Ey9tfiowDSTMAK2DoJNFo=
  - secure: kxJQ2Tt5vMBwSvtjyBUDsPl9OmhEfKCATcs0tR2oKBsbppRxovf6xKCzM5+j9jaHKFZ9DlAzq8CpFGoptDL09g2x96SrBrofcfaYiUlz9QGcIpSpA/7TtkzTnUKyi131JjRIy9ZUGe6UB0/kt//vjoT3LrNoXzglUe8BO7LVauobqU/AgXzLMl1iiHsLqEXT5nZblljxgXNUZkqq2lGrYkadOl6CP5NOcxE5YUGdIdbWdNaxWwpw3haeGyzM0Da4NVt6FcRpMWpYAIINp1r4/cmyBgPc7iN2joQ31qcBYdyer4LZqp90YgvcZAWoX8oChyxpyxiSpwM1VuCkQgxTN8PFhH1KID9xd+chLpyVBjCtc37S51OMv5Hpf0jhfQJG2I4zINegC8LthGAeU/bqoZ8NWL1ku3TAHa1unXwKdBnZnYeTIM1ZNc3Eeg2ylJMqOz7rDX0VH6AroTBjEruSUgV0C7kurOCycEbdC7fPUmsSpFIuur+MiGXgzWiwJlhI0PzKBEh5MtJHbyLq62oFkVG1aAyqy8imiXtL7ReCBlNJROhIlXrdz2MV1pHh3BHuLCjh7m/V851EaAqNueLrHz3Fme2+/0fxu5LwyyX3+CdazORM/olOS0YTXpjoH9kvdmW1ncMCG3kZghimgZYlLMVGD9fsLVlJmzBgzlPiuRw=
  - secure: GRmBoojlTqgJgwdUkRgvMSaelN8cU9bxj7eC4kG361PARR5LqETZLrwvHWVX9p0SjbWqL49qnE3RoGtBaSFmy2tC3A+J0EqK3rhzDHpkDDtKrj5nK5dYxxkb3kVaIX1CDBfIhK7hmwRcaMH8Oux+nw6Z2W3f+4S6na2SKZLkbhCKKkACnstoFBeLWPq6LhA0EUZGm7jmMu0upVWcx7vc3/hQh9N69LnTh/k+mzlece60+t50PcD3TRmk7TOHZD1ZtkeY1e/BmTtr2xvmm0/0B4DmOw/kvGPAZ5eF9jtAH88WvjJp0kxZwfXQWvmXy5bNLVVQQkhcs+GMw3oF89DMHlnFX/8zi85Z89V+UIyE0+bCrP6BZpZQiqCtAstVk0qNxNrH/x2ifYV99aUTcwr700olrHsqF33PGG2jsH6zQ2ASZXFcFnxkf4csO1BUFVBg/xeJ1g25+7SCgda5gs7udPFZwtiZyhw5QItUQPM2ZGGb+8D9p/gB99IrY0OcI8q1mkVTpqBA3/QhRksW/E8W88YqIDcoejQyKk35NLvyYO1fGUd7SVPgq565p0pzr1FZxl8vXAhLj/zz+E9wLUvPQjTvutj31myVs6GOKfYrKtM9TDDig8aBivGVYi/2dbohqL7y5g4CtRKkXrHlf6djqunaTS22Bqv3lj/S7MIhujs=
  - secure: i05I2gg3pKANb0ZAovQnduMhYYwn1l1HCV3rKNKGyEpBO4PfzUVuYMOwZdwaKjxpjyugG/UuFRf/GaJuHQefILEexxQ1sSAJ7ci2+bkjB0iCchlB7dGYebDp/Go36iuzxmi3RRim4cTa33BZXsivHdisvsJrxN9Q7BVhbcNOoXkQlSsa42Op3xPFTAxUbuRua8dHTqJh6KwmEqHS0F4VRNE2LHIh20EyOW4PX4G5hxS9Lv8pARm1opSGK9L6XxZLgv7ZtUoqNENeNzfG8udJNbCSTU2w/FDiynt+FGmhhQEhkqJm8MewX0BzJHueJf0qF41e/tGW4s1g9/MhN9Ih4WgRnFNbcKKvOs27SEd0QcmKiE/T7/04bqyTcYtPxL7B7EQr8sAdZmGW7DhywoBGoMCsaTmtoabD0zcrinrpNFmpf9/iTzmdIAA0+KmJVEnzu9i5oo7OUSgMdmzsI/g3MDzhxPX8IfOc3+Z+WY2dTkM5dAGRwHXqkkByoIGg7BaPa01AK1cn3yKJPlRGPbOoQPF3qS4/hW5FOw6EEcFQb0rszVloV88LjwBcNLsy9L7s3Os6D9Yw5nXnOtTpwDcc91kH0t8GcaRC2BkZRfPZn121lFPaW9AGkHSTrdUq61cJ/XQRQMkhcVXg+vgOHrlwkLGQk2dv43fJ1mqvl526fgA=
branches:
  only:
  - master
before_install:
- openssl aes-256-cbc -K $encrypted_40d97da57ddf_key -iv $encrypted_40d97da57ddf_iv
  -in eksamen-devops-f7bc3c2f300a.json.enc -out eksamen-devops-f7bc3c2f300a.json -d
- curl https://sdk.cloud.google.com | bash > /dev/null
- source "$HOME/google-cloud-sdk/path.bash.inc"
- gcloud auth activate-service-account --key-file=eksamen-devops-f7bc3c2f300a.json
- gcloud config set project "${GCP_PROJECT_ID}"
- export GOOGLE_APPLICATION_CREDENTIALS=./eksamen-devops-f7bc3c2f300a.json
- wget https://releases.hashicorp.com/terraform/"$tf_version"/terraform_"$tf_version"_linux_amd64.zip
- unzip terraform_"$tf_version"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$tf_version"_linux_amd64.zip
install: true
script:
- |-
  set -ex;
  export TF_VAR_logz_token=$LOGZ_TOKEN
  export TF_VAR_logz_url=$LOGZ_URL
  terraform init
  terraform plan
  terraform apply --auto-approve
  terraform output

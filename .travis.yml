env:
  global:
  - GCP_PROJECT_ID=eksamen-devops
  - tf_version=0.13.3
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - secure: Nh9i1jFUQiAlYH4DTq1XQPTPh9wh+2LTkWtPvuf6beGmP7s2mPbLR/xWyGWW+ktTIvBzzhp8FpBW70dq8+Oy3u/d5VPvKQ8U5ZoUxdWbho3hysRvfwThBHz7bgb3wK6jZ69VMBVOoULLvulUWnlRR9vV9ZDOJJwFciMpcQoPSyXcWjqK4M7DUxlVYdmz1vCgClU7AuA/idWT3CRS6RqKTxOhpG7L8hWOgzpLSVWJOfxzGiVARTRUaf8cQeFJRjAuWg0K/krOWzMusU/N9ln52HT88lB8inThA7TkLx3MqFdctlKtJTIm/ZzbcOeH9Dw9qSlUKl/jfD4GGxiv7lOKVz1pcke2Y/SjBU+MdCFmMyxG7+C6UBLYAug0tjKuKmpK+4d3KOvQuOHzzUdY+68cC8UOh67cGoQzYIsEqtWrU7sQHhcSrrfX50pNqMW6X1C01JIud8txKkRIkVrWd079E5LnJx3srKFSIOvfdwe+TyMuTrngDDW6YdloqUgQAa4JeCRwW4ZcUc4Q0iDepyYmlh9dyukl/EoKPg2d8eeeyqPzU6NmdihmIivoQxxi3LT7aMJy3h5x01U2q+LVuJe38SeCaIeOMA8mUQXQtZ8UaT4JrA99P+d6YWwqJ3i9gc4nHW4piEEsySA1eaoqs9cLQIolJ0+lhbdL36lDMbOEJL0=
  - secure: IikHqhVlgr8EJlGdub7acvVy+B3Mo7LYa4+G806KDbBueS4Cb3ThCq/DxJEBJnHqIoPnCaZoiEMtaD2UllvVk3AgZv8lGlOiQWDhNhaZ1aCNNQru7yKmihXjUeCr5zPM9YQRn8Kgfup0b9p9hug7R16ZeAGHSpvJz4/8JIeoi7DDMabn/0Fs7UtByMg79pvgoKxN/NhDjii0iZ2FmSz8L5CfzveAui4hdCNYSYKxVsPnxuY6mFr7oDlx2TOFY4uV2TDp+RTlMC5WMkhasDzFjeH4DpbmS0IJcyO0oAI7os57NurGj03HdMqtQD7sGbS+qFnsnbY2d46ywVaXs/oDUcfa3rMKQWs8Jf06Wqb4lCulgcdkEqlrUO9JoRqgLPY9DC0Bjyth01W9isOXMBwUiCnRXRP8EtgdvktFzJ9yHmSYhbLHGkRsnqNbhBO50Q3N4Ffm9jtgZeEsxXnEwELfLUJshFYv6NNhAQWDVl3x9ruHYXEypFvZHKQeE2aTIsHue4fK5jWgLhfZsQ6uu/ckvVyoBacmnSNa07vtfiLp+HTYZriTm/Z6q3K25n/QxOToMXqAfNAFN3SmEfcZ502TGtdb8OVkeP1EE5lbpO7pAAs3/io1L5FFKoavtM+G+vDJwJ+GEQD48xntshb2ALPAX7Ey9tfiowDSTMAK2DoJNFo=
branches:
  only:
  - master
before_install:
- openssl aes-256-cbc -K $encrypted_40d97da57ddf_key -iv $encrypted_40d97da57ddf_iv
  -in eksamen-devops-f7bc3c2f300a.json.enc -out eksamen-devops-f7bc3c2f300a.json -d
- curl https://sdk.cloud.google.com | bash > /dev/null
- source "$HOME/google-cloud-sdk/path.bash.inc"
- gcloud auth activate-service-account --key-file=eksamen-devops-f7bc3c2f300a.json
- gcloud config set project "${GCP_PROJECT_ID}"
- export GOOGLE_APPLICATION_CREDENTIALS=./eksamen-devops-f7bc3c2f300a.json
- wget https://releases.hashicorp.com/terraform/"$tf_version"/terraform_"$tf_version"_linux_amd64.zip
- unzip terraform_"$tf_version"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$tf_version"_linux_amd64.zip
install: true
script:
- |-
  set -ex;
  export TF_VAR_logz_token=$LOGZ_TOKEN
  export TF_VAR_logz_url=$LOGZ_URL
  terraform init
  terraform plan
  terraform apply --auto-approve
  terraform output
